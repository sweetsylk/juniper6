{% extends 'base_content.html' %}
{% block content %}

<!-- Display a given user's profile
    Could add an option for them to modify what data is and isn't displayed on their dashboard 
    
    Could incl CRUD options here as well iff the user whose recipes we're displaying == the logged in user -->

<div class="container">
  <div class="row justify-content-center">
    <div class="col-md-12">

      <h1 class="text-center mt-4 mb-4">{{ profile_user.full_name }}</h1>

    {% if not show_recipes_only %}

      <img src="{{ profile_user.gravatar_url }}"
      alt="Profile Picture"
      class="rounded-circle d-block mx-auto shadow mb-3"
      width="180" height="180">

      {% if request.user != profile_user %}
        <div class="text-center mb-3">
          <form method="post" action="{% url 'toggle-follow' profile_user.pk %}">
            {% csrf_token %}
            <button type="submit"
                    class="btn btn-outline-secondary rounded-pill px-4 shadow-sm">
              {% if request.user in profile_user.followers.all %}
                Unfollow
              {% else %}
                Follow
              {% endif %}
            </button>
          </form>
        </div>
    {% endif %}

      <div class="card shadow-sm p-4 mx-auto mt-4 text-center"
        style="max-width: 720px; border-radius: 12px;">
        <p><strong>Username:</strong> {{ profile_user.username }}</p>
        <p><strong>Email:</strong> {{ profile_user.email }}</p>
        <p><strong>Member since:</strong> {{ profile_user.date_joined|date:"F j, Y" }}</p>
      </div>

      <div class="card shadow-sm p-4 mx-auto mt-4 text-center"
           style="max-width: 720px; border-radius: 12px;">

      <div class="d-flex justify-content-center gap-5">
        <div>
          <div class="text-uppercase fw-semibold text-muted small">
            Followers
          </div>
          <div class="fs-3 fw-bold text-secondary">
            {{ follower_count }}
          </div>
      </div>

      <div>
        <div class="text-uppercase fw-semibold text-muted small">
          Following
        </div>
        <div class="fs-3 fw-bold text-secondary">
          {{ following_count }}
        </div>
      </div>

    </div>

    {% if request.user == profile_user %}
      <div class="mt-3">
        
        <a class="text-secondary text-decoration-none me-3"
          data-bs-toggle="collapse"
          href="#followersList">
          View followers
        </a>

        <a class="text-secondary text-decoration-none"
          data-bs-toggle="collapse"
          href="#followingList">
          View following
        </a>

        <div class="collapse mt-3" id="followersList">
          <ul class="list-unstyled mb-0">
            {% for follower in followers %}
              <li class="mb-1">
                <a href="{% url 'display_user_profile' follower.username %}">
                  {{ follower.full_name|default:follower.username }}
                </a>
              </li>
            {% empty %}
              <li class="text-muted">No followers yet.</li>
            {% endfor %}
          </ul>
        </div>

        <div class="collapse mt-3" id="followingList">
          <ul class="list-unstyled mb-0">
            {% for followee in following %}
              <li class="mb-1">
                <a href="{% url 'display_user_profile' followee.username %}">
                  {{ followee.full_name|default:followee.username }}
                </a>
              </li>
            {% empty %}
              <li class="text-muted">Not following anyone yet.</li>
            {% endfor %}
          </ul>
        </div>
      </div>
    {% endif %}

  </div>

      <div class="card shadow-sm p-4 mx-auto mt-4 text-center"
           style="max-width: 720px; border-radius: 12px;">

      <div class="d-flex justify-content-center gap-5">

      <div>
        {% if request.user == profile_user %}
          <a href="{% url 'dashboard_my_recipes' %}"
            class="text-decoration-none text-secondary">
            <div class="fs-4 fw-bold">{{ recipe_count }}</div>
            <small class="text-muted">Recipes</small>
          </a>
        {% else %}
          <a href="{% url 'display_other_users_recipes' profile_user.username %}"
            class="text-decoration-none text-secondary">
            <div class="fs-4 fw-bold">{{ recipe_count }}</div>
            <small class="text-muted">Recipes</small>
          </a>
        {% endif %}
      </div>

      <div>
        {% if request.user == profile_user %}
          <a href="{% url 'dashboard_my_reviews' %}"
            class="text-decoration-none text-secondary">
            <div class="fs-4 fw-bold">{{ user_reviews.count }}</div>
            <small class="text-muted">Reviews</small>
          </a>
        {% else %}
          <div class="fs-4 fw-bold text-secondary">{{ user_reviews.count }}</div>
          <small class="text-muted">Reviews</small>
        {% endif %}
      </div>

      <div>
        {% if request.user == profile_user %}
          <a href="{% url 'display_saved_recipes' profile_user.pk %}"
            class="text-decoration-none text-secondary">
            <div class="fs-4 fw-bold">{{ saved_count }}</div>
            <small class="text-muted">Saved</small>
          </a>
        {% else %}
            <div class="fs-4 fw-bold text-secondary">{{ saved_count }}</div>
            <small class="text-muted">Saved</small>
        {% endif %}
      </div>

    </div>

  </div>

      <div class="card shadow-sm p-4 mx-auto mt-4 mb-5 text-center"
           style="max-width: 720px; border-radius: 12px;">

      <h5 class="mb-3">About</h5>

        {% if profile_user.bio %}
          <p class="mb-3">{{ profile_user.bio }}</p>
        {% else %}
          <p class="text-muted mb-3">This user hasnâ€™t added a bio yet.</p>
        {% endif %}

      <ul class="list-unstyled mb-0">
        {% if profile_user.favourite_cuisine %}
          <li><strong>Favourite cuisine:</strong> {{ profile_user.favourite_cuisine }}</li>
        {% endif %}

        {% if profile_user.cooking_level %}
          <li><strong>Cooking level:</strong> {{ profile_user.get_cooking_level_display }}</li>
        {% endif %}

        {% if profile_user.dietary_style %}
          <li><strong>Dietary style:</strong> {{ profile_user.get_dietary_style_display }}</li>
        {% endif %}
      </ul>

  </div>

      {% if request.user == profile_user %}
        <div class="text-center mb-4">
          <a href="{% url 'update_profile' %}"
            class="btn btn-outline-secondary rounded-pill shadow-sm">
            Edit Profile
          </a>
        </div>
      {% endif %}

    {% endif %}

    {% if show_recipes_only %}
      <h3 class="text-center mb-4">
        Recipes by {{ profile_user.full_name }}
      </h3>

      {% if user_recipes %}
          <div class="row row-cols-1 row-cols-md-3 row-cols-lg-4 row-cols-xl-5 g-4">
            {% for recipe in user_recipes %}
              {% include "partials/recipe_card.html" with recipe=recipe %}
            {% endfor %}
          </div>
        {% else %}
          <p class="text-muted text-center">No recipes yet.</p>
        {% endif %}

    {% endif %}
    
    </div>
  </div>
</div>

{% endblock %}