{% extends 'base_content.html' %}
{% block content %}

<!-- Display a given user's profile
    Could add an option for them to modify what data is and isn't displayed on their dashboard 
    
    Could incl CRUD options here as well iff the user whose recipes we're displaying == the logged in user -->

<div class="container">
  <div class="row justify-content-center">
    <div class="col-md-12">

      {% if not show_recipes_only %}

      <h1 class="text-center mt-4 mb-4">{{ profile_user.full_name }}</h1>

      {% if profile_user.profile_image %}
      <img src="{{ profile_user.profile_image.url }}" alt="Profile Picture"
        class="rounded-circle img-fluid d-block mx-auto mb-3 shadow"
        style="width: 150px; height: 150px; object-fit: cover;">
      {% else %}
      <img src="{{ profile_user.gravatar_url }}" alt="Profile Picture"
        class="rounded-circle img-fluid d-block mx-auto mb-3 shadow"
        style="width: 150px; height: 150px; object-fit: cover;">
      {% endif %}

      <div class="profile-card shadow-sm p-4 mx-auto text-center"
           style="max-width: 600px; border-radius: 12px;">
        <p><strong>Username:</strong> {{ profile_user.username }}</p>
        <p><strong>Email:</strong> {{ profile_user.email }}</p>
        <p><strong>Member since:</strong> {{ profile_user.date_joined|date:"F j, Y" }}</p>

        <div class="d-flex justify-content-center gap-4 mt-3">
        <div><strong>{{ recipe_count }}</strong><br><small>Recipes</small></div>
        <div><strong>{{ user_reviews.count }}</strong><br><small>Reviews</small></div>
        <div><strong>{{ saved_count }}</strong><br><small>Saved</small></div>
        </div>
      </div>

      {% if request.user != profile_user %}
      <div class="d-flex justify-content-center gap-2 mt-3">

        <form method="post" action="{% url 'toggle-follow' profile_user.pk %}">
          {% csrf_token %}
          {% if request.user in profile_user.followers.all %}
            <button type="submit"
                    class="btn btn-outline-secondary rounded-pill px-4 shadow-sm">
              Unfollow
            </button>
          {% else %}
            <button type="submit"
                    class="btn btn-outline-secondary rounded-pill px-4 shadow-sm">
              Follow
            </button>
          {% endif %}
        </form>

        <a href="{% url 'display_other_users_recipes' profile_user.username %}"
          class="btn btn-outline-secondary rounded-pill px-4 shadow-sm">
          View Recipes
        </a>

        </div>
      {% endif %}

      {% if request.user == profile_user %}
      <div class="d-flex justify-content-center mt-3">
        <a href="{% url 'update_profile' %}"
           class="btn btn-outline-secondary rounded-pill px-4 shadow-sm">
          <i class="bi bi-pencil me-1"></i>
          Edit Profile
        </a>
      </div>
      {% endif %}

    <hr class="my-5">

    <div class="row text-center mb-4">
      <div class="col-md-6">
        <h4>Followers ({{ followers.count }})</h4>
        {% if followers %}
        <ul class="list-unstyled">
          {% for follower in followers %}
          <li>
            <a href="{% url 'display_user_profile' follower.username %}">
              {{ follower.full_name|default:follower.username }}
            </a>
          </li>
          {% endfor %}
        </ul>
        {% else %}
        <p class="text-muted">No followers yet.</p>
        {% endif %}
      </div>

      <div class="col-md-6">
        <h4>Following ({{ following.count }})</h4>
        {% if following %}
        <ul class="list-unstyled">
          {% for followee in following %}
          <li>
            <a href="{% url 'display_user_profile' followee.username %}">
              {{ followee.full_name|default:followee.username }}
            </a>
          </li>
          {% endfor %}
        </ul>
        {% else %}
        <p class="text-muted">Not following anyone yet.</p>
        {% endif %}
      </div>
      </div>

      {% endif %}

      <hr class="my-5">

    {% if show_recipes_only %}
    <h3 class="text-center mb-4">
      Recipes by {{ profile_user.full_name }}
    </h3>

    {% if user_recipes %}
        <div class="row row-cols-1 row-cols-md-3 row-cols-lg-4 row-cols-xl-5 g-4">
          {% for recipe in user_recipes %}
            {% include "partials/recipe_card.html" with recipe=recipe %}
          {% endfor %}
        </div>
      {% else %}
        <p class="text-muted text-center">No recipes yet.</p>
      {% endif %}
    {% endif %}

    </div>
  </div>
</div>

{% endblock %}